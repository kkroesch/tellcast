<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Tellcast</title>
  <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@latest/css/pico.min.css" />
  <style>
    .fade-in {
      animation: fadeSlideIn 0.6s ease-out;
    }
    @keyframes fadeSlideIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <main class="container" style="max-width: 600px; margin-top: 4rem;">
    <h1>üèπ Tellcast</h1>
    <form id="tweetForm">
      <label for="text">Was passiert gerade?</label>
      <textarea id="text" name="text" maxlength="280" required></textarea>
      <button type="submit">Abschicken</button>
    </form>
    <hr />
    <div id="tweets"></div>
  </main>

  <script>
    const container = document.getElementById('tweets');
    const form = document.getElementById('tweetForm');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const data = new FormData(form);
      const params = new URLSearchParams(data);
      await fetch('/tweet', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: params.toString()
      });
      form.reset();
    });

    const events = new EventSource('/tweet/events');
    events.onmessage = (e) => {
      const { html } = JSON.parse(e.data);
      prependTweet(html);
    };

    function prependTweet(html) {
      const div = document.createElement('div');
      div.innerHTML = html;
      const el = div.firstChild;
      el.classList.add('fade-in');
      container.prepend(el);
    }
  </script>
</body>
</html>
